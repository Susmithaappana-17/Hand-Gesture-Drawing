<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Hand Gesture Paint</title>
  <style>
    body { background:#111; color:#eee; text-align:center; font-family:Arial; }
    canvas { border:2px solid #444; border-radius:8px; }
    #controls { margin-top:10px; }
    button { margin:5px; padding:10px 15px; border:none; border-radius:5px; background:#333; color:#fff; cursor:pointer; }
    #gesture { margin-top:8px; font-size:18px; font-weight:bold; color:#0f0; }
  </style>
</head>
<body>
  <h2>Hand Gesture Paint</h2>
  <video id="video" autoplay playsinline style="display:none"></video>
  <canvas id="output" width="640" height="480"></canvas>
  <canvas id="draw" width="640" height="480" style="position:absolute; left:0; top:0;"></canvas>

  <div id="controls">
    <button onclick="clearCanvas()">Clear</button>
    <button onclick="saveCanvas()">Save</button>
  </div>
  <div id="gesture">Gesture: None</div>


  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <script>
    const video = document.getElementById('video');
    const output = document.getElementById('output');
    const ctx = output.getContext('2d');
    const drawCanvas = document.getElementById('draw');
    const dctx = drawCanvas.getContext('2d');
    const gestureLabel = document.getElementById('gesture');

    let lastX=0, lastY=0;
    let drawingColor="red";

    const colorList=["red","green","blue","yellow","cyan","magenta"];
    let colorIndex=0;

    const hands = new Hands({locateFile: (file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({maxNumHands:1, modelComplexity:1, minDetectionConfidence:0.7, minTrackingConfidence:0.7});

    hands.onResults(results=>{
      ctx.clearRect(0,0,output.width,output.height);
      ctx.drawImage(results.image,0,0,output.width,output.height);

      if(results.multiHandLandmarks && results.multiHandLandmarks.length>0){
        const lm = results.multiHandLandmarks[0];
        drawConnectors(ctx,lm,Hands.HAND_CONNECTIONS,{color:"#00ff00",lineWidth:2});
        drawLandmarks(ctx,lm,{color:"#ff0000",lineWidth:1});

        // Detect fingers up
        const fingers = fingersUp(lm);
        const count = fingers.reduce((a,b)=>a+b,0);

        if(count===0){
          gestureLabel.innerText="Gesture: Fist → Clear";
          clearCanvas();
        }
        else if(count===5){
          gestureLabel.innerText="Gesture: Open Hand → Save";
          saveCanvas();
        }
        else if(fingers[1] && fingers[2]){ 
          gestureLabel.innerText="Gesture: Select Mode";
          
          colorIndex = (colorIndex+1) % colorList.length;
          drawingColor=colorList[colorIndex];
          lastX=0; lastY=0;
        }
        else if(fingers[1] && !fingers[2])
          gestureLabel.innerText="Gesture: Drawing";
          const ix = lm[8].x * output.width;
          const iy = lm[8].y * output.height;
          if(lastX && lastY){
            dctx.strokeStyle = drawingColor;
            dctx.lineWidth = 6;
            dctx.lineJoin = "round"; dctx.lineCap = "round";
            dctx.beginPath();
            dctx.moveTo(lastX,lastY);
            dctx.lineTo(ix,iy);
            dctx.stroke();
          }
          lastX=ix; lastY=iy;
        }
        else{
          gestureLabel.innerText="Gesture: Other";
          lastX=0; lastY=0;
        }
      } else {
        gestureLabel.innerText="Gesture: None";
        lastX=0; lastY=0;
      }
      ctx.drawImage(drawCanvas,0,0);
    });

    const camera = new Camera(video,{
      onFrame: async()=>{ await hands.send({image:video}); },
      width:640, height:480
    });
    camera.start();

  
    function fingersUp(lm){
      const tips=[4,8,12,16,20];
      const f=[];
    
      f.push(lm[tips[0]].x < lm[3].x ? 1:0);
     
      for(let i=1;i<5;i++){
        f.push(lm[tips[i]].y < lm[tips[i]-2].y ? 1:0);
      }
      return f;
    }

    function clearCanvas(){ dctx.clearRect(0,0,drawCanvas.width,drawCanvas.height); }
    function saveCanvas(){
      const link=document.createElement("a");
      link.download="canvas.png";
      link.href=drawCanvas.toDataURL("image/png");
      link.click();
    }
  </script>
</body>
</html>

